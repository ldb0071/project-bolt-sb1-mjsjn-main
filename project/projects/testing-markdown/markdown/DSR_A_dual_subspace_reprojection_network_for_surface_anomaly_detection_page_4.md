Page 4

The DSR architecture is outlined in Figure 2. The input image is projected into a quantized latent space (Section 3.1) and then decoded in parallel by two decoders

Fig. 2. The DSR architecture. During training, the non-anomalous image quantized feature maps ( Q hi , Q lo ) are replaced by the anomaly augmented feature maps ( Q a,hi , Q a,lo ) generated by the latent space sampling procedure (shaded block). The pathway marked with green arrows are used when training the Upsampling module with simulated smudges and at inference.

<!-- image -->

specialized on different appearance subspaces. One decoder, the general object appearance decoder (Section 3.2), is trained for high-fidelity reconstruction of arbitrary natural images, while the second, object-specific decoder (Section 3.3), is restricted to reconstructing only normal local appearances of the selected object. The two reconstructed images are then analyzed by the anomaly detection module (Section 3.4). The output localization map is at feature resolution and is upsampled to the input image resolution by the Upsampling module (Section 3.5).

DSR is trained by a novel technique of sampling the quantized latent feature space for generating near-in-distribution anomalies (Section 3.6). The DSR training regime is explained in Section 3.7.

## 3.1 Quantized latent space encoder

DSRleverages quantized feature space representation, which has recently demonstrated strong modelling capabilities of complex natural image distributions ,e.g., [9,15]. The approach is based on quantizing the extracted features with features from a codebook K which has been trained for optimal decoding of spatial configurations of quantized features into high-fidelity images.