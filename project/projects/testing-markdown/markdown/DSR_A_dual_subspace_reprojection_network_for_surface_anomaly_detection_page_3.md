Page 3

Our contribution is thus twofold: (i) the dual image reconstruction branch architecture with discretized latent representation and (ii) the latent space anomaly generation method that leverages the learned representation of natural images.

DSRsubstantially outperforms the state-of-the-art in near-in-distribution anomaly detection on the recent challenging KSDD2 [6] and delivers state-of-the-art performance on the standard MVTec anomaly detection dataset [3].

## 2 Related Work

Many recent surface anomaly detection methods are based on image reconstruction [1,2,5], where an encoder-decoder network is trained for image reconstruction on anomaly free images. The anomaly detection capability of these methods is based on the assumption that the trained networks will be unable to accurately reconstruct anomalous regions due to never seeing them during training, making anomalies detectable by comparing the input image to its reconstruction. The core assumption often does not hold, especially in more diverse datasets, as the reconstruction networks learn to generalize well which enables accurate anomaly reconstruction, hampering the downstream anomaly detection performance. Similarly, in [22] iterative inpainting is used for image reconstruction, however, the method is sensitive to random pattern regions that are difficult to inpaint and which cause false positive detections.

Several recent approaches utilize the ability of pretrained networks to extract informative features from an image. In [4] a network is trained on anomaly free images to reconstruct features extracted by the pretrained network. In [19] a feature map is generated as a concatenation of several layers of a pretrained network. An auto-encoder is then trained to reconstruct the resulting feature map. As with image reconstruction based anomaly detection methods, the networks in [4,19] are assumed to be unable to reconstruct the features extracted by the pretrained networks. In [17], a pretrained network is also used to extract informative features from anomaly free data, however instead of relying on reconstruction for anomaly detection, a multivariate gaussian is fit to the anomaly-free data. A Mahalanobis distance is then used as an anomaly score. A similar approach is used in [7], however, a Gaussian is fit at each location in the feature map.

Discriminative unsupervised anomaly detection methods [21,12,11] utilize synthetically generated anomalies to train a discriminative anomaly detection network. In order to alleviate overfitting on the synthetic anomaly appearance, in [21] a reconstruction network is used to restore the normal appearance of the synthetic anomalies. The discriminative network then learns a distance function between the original image and its reconstruction to perform anomaly detection. Due to a limited distribution of the generated synthetic anomalies, the reconstruction network may overfit to the synthetic appearance and fail to restore normality in near-distribution anomalies, leading to a reduction in performance in downstream anomaly detection.

## 3 DSR